ansible_user: taka
source_sudo_password: "source_user_password"
destination_sudo_password: "destination_user_password"
set_dir: '/home/{{ ansible_user }}/yamisskey-provision'
domain: yami.ski
github_org: yamisskey-dev

# =========================================
# Host-Based Service Configuration
# =========================================

# Service distribution by host (based on actual deployment architecture)
host_services:
  balthasar:
    # Main production server - Social & Apps (user-facing services only)
    modsecurity_nginx: 8080     # Main reverse proxy
    misskey: 3001              # Yamisskey container port
    neo_quesdon: 3025          # Neo-Quesdon
    outline: 3004              # Outline
    element: 8081              # Element Matrix client
    synapse: 8008              # Matrix Synapse
    cryptpad: 3003             # CryptPad (main) 3333 (websocket)
    cadvisor: 8085             # cAdvisor
    minio_api: 9000            # MinIO API (moved from raspberrypi)
    minio_console: 9001        # MinIO Console (moved from raspberrypi)
    # All public services route through modsecurity_nginx:8080

  caspar:
    # Security & monitoring hub + Auth infrastructure
    modsecurity_nginx: 8080
    uptime_kuma: 3009          # Uptime Kuma (monitoring)
    prometheus: 9090           # Prometheus (monitoring)
    grafana: 3000              # Grafana (monitoring dashboard)
    blackbox_exporter: 9115    # Blackbox Exporter
    alert_manager: 9093        # AlertManager
    misskey_beta: 3002         # Misskey Beta (test environment for yamisskey-dev)
    # Auth & Security services (moved from balthasar)
    authentik: 9003            # Authentik (identity provider)
    mcaptcha: 7493             # mCaptcha (CAPTCHA service)
    # Nostr services (experimental)
    nostr: 8008                # Nostr relay (nostr-rs-relay)

  linode_prox:
    # External proxy services
    media_proxy_rs: 12766      # Media proxy service
    nginx: 80                  # Nginx for summaly
    summaly: 3030              # Summaly (behind nginx)
    squid: 3128                # Squid proxy

  raspberrypi:
    # Minecraft dedicated server
    minecraft: 25565           # Minecraft Java server
    playit: 8080               # playit.gg proxy

  ctfd:
    # CTF Platform Server (Proxmox VM on mary)
    modsecurity_nginx: 8080    # Main reverse proxy
    ctfd: 8000                 # CTFd platform

  tpot:
    # T-Pot Honeypot Server (Proxmox VM on mary)
    # Note: T-Pot manages its own ports internally
    web_ui: 64297              # T-Pot Web UI (Kibana, Attack Map, etc.)
    ssh: 64295                 # T-Pot SSH (management)
    cockpit: 64294             # Cockpit (system management)

# Cloudflared ingress mapping
cloudflared_ingress:
  balthasar:
    # All services behind ModSecurity-Nginx (user-facing services only)
    - hostname: "{{ domain }}"
      service: "http://localhost:{{ host_services.balthasar.modsecurity_nginx }}"
    - hostname: "neo-quesdon.{{ domain }}"
      service: "http://localhost:{{ host_services.balthasar.modsecurity_nginx }}"
    - hostname: "drive.{{ domain }}"
      service: "http://localhost:{{ host_services.balthasar.modsecurity_nginx }}"
    - hostname: "wiki.{{ domain }}"
      service: "http://localhost:{{ host_services.balthasar.modsecurity_nginx }}"
    - hostname: "matrix.{{ domain }}"
      service: "http://localhost:{{ host_services.balthasar.modsecurity_nginx }}"
    - hostname: "chat.{{ domain }}"
      service: "http://localhost:{{ host_services.balthasar.modsecurity_nginx }}"
    - hostname: "pad.{{ domain }}"
      service: "http://localhost:{{ host_services.balthasar.modsecurity_nginx }}"

  caspar:
    # Security & monitoring services behind ModSecurity-Nginx
    - hostname: "beta.{{ domain }}"
      service: "http://localhost:{{ host_services.caspar.modsecurity_nginx }}"
    - hostname: "grafana.{{ domain }}"
      service: "http://localhost:{{ host_services.caspar.modsecurity_nginx }}"
    - hostname: "uptime.{{ domain }}"
      service: "http://localhost:{{ host_services.caspar.modsecurity_nginx }}"
    # Auth & Security services (moved from balthasar)
    - hostname: "auth.{{ domain }}"
      service: "http://localhost:{{ host_services.caspar.modsecurity_nginx }}"
    - hostname: "captcha.{{ domain }}"
      service: "http://localhost:{{ host_services.caspar.modsecurity_nginx }}"
    # Nostr services
    - hostname: "nostr.{{ domain }}"
      service: "http://localhost:{{ host_services.caspar.modsecurity_nginx }}"

  ctfd:
    # CTF platform (dedicated VM on mary)
    - hostname: "ctf.{{ domain }}"
      service: "http://localhost:{{ host_services.ctfd.modsecurity_nginx }}"

  linode_prox:
    # Direct service exposure for external proxies
    - hostname: "media.{{ domain }}"
      service: "http://localhost:{{ host_services.linode_prox.media_proxy_rs }}"
    - hostname: "summaly.{{ domain }}"
      service: "http://localhost:{{ host_services.linode_prox.nginx }}"
  # Test services can be added to the lists above as needed

# =========================================
# Nginx Server Names (for ModSecurity-Nginx)
# =========================================
misskey_server_name: "{{ domain }}"
synapse_server_name: "matrix.{{ domain }}"
element_server_name: "chat.{{ domain }}"
ctfd_server_name: "ctf.{{ domain }}"
grafana_server_name: "grafana.{{ domain }}"
cryptpad_server_name: "pad.{{ domain }}"
authentik_server_name: "auth.{{ domain }}"
outline_server_name: "wiki.{{ domain }}"
uptime_server_name: "uptime.{{ domain }}"
mcaptcha_server_name: "captcha.{{ domain }}"
neo_quesdon_server_name: "neo-quesdon.{{ domain }}"
minio_api_server_name: "drive.{{ domain }}"
nostr_server_name: "nostr.{{ domain }}"
