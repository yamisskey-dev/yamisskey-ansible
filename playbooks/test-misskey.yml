---
- name: Test yamisskey.servers collection - Misskey deployment
  hosts: localhost
  connection: local
  gather_facts: true
  vars:
    # Test variables
    test_check_mode: false

  tasks:
    - name: Include compat role from collection
      ansible.builtin.include_role:
        name: yamisskey.servers.compat
      tags:
        - compat
        - test

    - name: Include misskey role from collection
      ansible.builtin.include_role:
        name: yamisskey.servers.misskey
      tags:
        - misskey
        - test

    - name: Display collection info
      ansible.builtin.debug:
        msg: |
          Successfully loaded roles from yamisskey.servers collection:
          - compat: {{ ansible_role_names | default([]) | select('match', '.*compat.*') | list }}
          - misskey: {{ ansible_role_names | default([]) | select('match', '.*misskey.*') | list }}
      tags:
        - info
