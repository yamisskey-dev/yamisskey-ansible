---
# MinIO構築専用Playbook
# 責任: TrueNAS Scale上でのMinIO環境構築のみ
- name: "TrueNAS MinIO Deployment"
  hosts: truenas
  become: yes
  gather_facts: yes

  pre_tasks:
    - name: Assert critical variables exist
      assert:
        that:
          - truenas_pool_name is defined
          - truenas_minio_app_name is defined
          - truenas_minio_domain is defined
          - truenas_minio_root_user is defined
          - truenas_minio_root_password is defined
          - truenas_tunnel_token is defined
        fail_msg: "Missing required TrueNAS variables. Check host_vars/truenas.yml"

  roles:
    - role: yamisskey.appliances.core
      tags: [core, infrastructure]
    - role: yamisskey.appliances.minio
      tags: [minio, deployment]

  post_tasks:
    - name: MinIO deployment completion
      debug:
        msg: |
          ==============================================
          ✅ MinIO Deployment Complete
          ==============================================
          App: {{ truenas_minio_app_name }}
          Domain: https://{{ truenas_minio_domain }}
          
          Next Steps:
          1. Configure mc client: mc alias set truenas https://{{ truenas_minio_domain }} <user> <password>
          2. Create buckets and policies
          3. Run migration: ansible-playbook migrate-minio.yml
          ==============================================