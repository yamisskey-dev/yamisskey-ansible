---
- name: MinIO data migration with comprehensive validation
  hosts: "{{ migrate_target | default('destination') }}"
  become: true
  gather_facts: true

  pre_tasks:
    - name: Pre-migration validation
      include_role:
        name: yamisskey.servers.migration_validator
      vars:
        validation_phase: pre_migration
      tags: ['validation', 'pre_migration']

  roles:
    - role: yamisskey.servers.migrate
      tags: ['migration', 'data_transfer']

  post_tasks:
    - name: Post-migration validation
      include_role:
        name: yamisskey.servers.migration_validator
      vars:
        validation_phase: post_migration
      tags: ['validation', 'post_migration']
