---
# Compatibility layer for servers-style variables
# This allows the minio role to work with both appliances and servers variable naming

- name: Map servers-style vars to appliances-style (MinIO root)
  set_fact:
    truenas_minio_root_user: "{{ minio_root_user }}"
    truenas_minio_root_password: "{{ minio_root_password }}"
  when:
    - truenas_minio_root_user is not defined
    - minio_root_user is defined and minio_root_password is defined

- name: Map servers-style vars to appliances-style (KMS key)
  set_fact:
    truenas_minio_kms_key: "{{ minio_kms_master_key }}"
  when:
    - truenas_minio_kms_key is not defined
    - minio_kms_master_key is defined

- name: Map servers-style vars to appliances-style (domain)
  set_fact:
    truenas_minio_domain: "{{ minio_api_server_name }}"
  when:
    - truenas_minio_domain is not defined
    - minio_api_server_name is defined

- name: Map servers-style vars to appliances-style (Cloudflare Tunnel token)
  set_fact:
    truenas_tunnel_token: "{{ cloudflare_tunnel_token }}"
  when:
    - truenas_tunnel_token is not defined
    - cloudflare_tunnel_token is defined

# === Reverse mapping (appliances-style -> servers-style) ===
- name: Map appliances-style vars to servers-style (MinIO root)
  set_fact:
    minio_root_user: "{{ truenas_minio_root_user }}"
    minio_root_password: "{{ truenas_minio_root_password }}"
  when:
    - minio_root_user is not defined
    - truenas_minio_root_user is defined and truenas_minio_root_password is defined

- name: Map appliances-style vars to servers-style (KMS key)
  set_fact:
    minio_kms_master_key: "{{ truenas_minio_kms_key }}"
  when:
    - minio_kms_master_key is not defined
    - truenas_minio_kms_key is defined

- name: Map appliances-style vars to servers-style (domain)
  set_fact:
    minio_api_server_name: "{{ truenas_minio_domain }}"
  when:
    - minio_api_server_name is not defined
    - truenas_minio_domain is defined

- name: Map appliances-style vars to servers-style (Cloudflare Tunnel token)
  set_fact:
    cloudflare_tunnel_token: "{{ truenas_tunnel_token }}"
  when:
    - cloudflare_tunnel_token is not defined
    - truenas_tunnel_token is defined