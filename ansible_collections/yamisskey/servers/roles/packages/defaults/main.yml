---
# Package management configuration
packages_profile: null  # Override with specific profile: development, server, ai-server, etc.
packages_extra: []      # Additional packages to install explicitly

# Package installation methods
packages_install_methods:
  # Standard APT packages
  apt:
    - btop
    - net-tools
    - nmap
    - inetutils-traceroute
    - rsync
    - zip
    - tor
    - mecab
    - libmecab-dev
    - mecab-ipadic-utf8
    - prometheus
    - rclone
    - fail2ban
    - unattended-upgrades
    - debsums
    - apt-show-versions
    - clamav
    - clamav-daemon
    - lynis
    - apparmor
    - auditd
    - sysstat
    - python3-passlib
    - rsyslog
    - logrotate
    - ufw
    - curl
    - dnsutils
    - docker.io
    - docker-compose
    - nginx
    - postgresql-client
    - redis-tools
    - htop
    - btop
    - jq
    - vim
    - nano
    - tree
    - git
    - wget
    - gnupg
    - ca-certificates
    - apt-transport-https
    - lsb-release
    - software-properties-common
    - openssh-client
    - tmux
    - lsof
    - tar
    - gzip
    - unzip
    - gawk
    - sed
    - findutils
    - coreutils
    - ansible
    - ansible-lint
    - yamllint
    - python3
    - python3-pip
    - python3-dev
    - python3-venv
    - python3-pytest
    - python3-tox
    - docker.io
    - docker-compose
    - playit
    - certbot
    - python3-certbot-nginx
    - libapache2-mod-security2
    - nginx-module-headers-more
    - postgresql
    - postgresql-contrib
    - mysql-server
    - mysql-client
    - redis-server
    - redis-tools
    - grafana
    - prometheus-node-exporter
    - node-exporter

  # APT repositories (with GPG keys)
  apt_repo:
    playit:
      gpg_key_url: "https://playit-cloud.github.io/ppa/key.gpg"
      gpg_key_file: "/etc/apt/trusted.gpg.d/playit.gpg"
      repo: "deb [signed-by=/etc/apt/trusted.gpg.d/playit.gpg] https://playit-cloud.github.io/ppa/data ./"
      filename: "playit-cloud"
      packages:
        - playit
    tailscale:
      gpg_key_url: "https://pkgs.tailscale.com/stable/{{ ansible_distribution | lower }}/{{ ansible_distribution_release | lower }}.noarmor.gpg"
      gpg_key_file: "/etc/apt/trusted.gpg.d/tailscale-archive-keyring.gpg"
      repo: "deb [signed-by=/etc/apt/trusted.gpg.d/tailscale-archive-keyring.gpg] https://pkgs.tailscale.com/stable/{{ ansible_distribution | lower }} {{ ansible_distribution_release | lower }} main"
      filename: "tailscale"
      packages:
        - tailscale

  # Manual downloads (GitHub releases, etc.)
  manual_download:
    cloudflared:
      download_url: "https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64"
      install_path: "/usr/local/bin/cloudflared"
      mode: "0755"
      owner: "root"
      group: "root"
      version_check: "cloudflared --version"

  # Python packages via pip
  pip:
    - name: requests
      version: "latest"
    - name: flask
      version: "latest"
    - name: ansible-lint
      version: "latest"
    - name: yamllint
      version: "latest"
    - name: sops
      version: "latest"
    - name: age
      version: "latest"

  # Manual installation scripts
  manual_script:
    mecab-ipadic-neologd:
      repo: "https://github.com/neologd/mecab-ipadic-neologd.git"
      dest: "/tmp/mecab-ipadic-neologd"
      script: "./bin/install-mecab-ipadic-neologd -n -a -y"
      check_path: "/usr/lib/x86_64-linux-gnu/mecab/dic/mecab-ipadic-neologd"

# Role-based package mapping
# Each role can specify its required packages
packages_by_role:
  # Core system roles
  common:
    Debian:
      - btop
      - net-tools
      - nmap
      - inetutils-traceroute
      - rsync
      - zip
      - tor
      - mecab
      - libmecab-dev
      - mecab-ipadic-utf8
      - prometheus
      - rclone
      - fail2ban
      - unattended-upgrades
      - debsums
      - apt-show-versions
      - clamav
      - clamav-daemon
      - lynis
      - apparmor
      - auditd
      - sysstat
      - python3-passlib
  security:
    Debian:
      - rsyslog
      - logrotate
      - ufw
      - fail2ban
      - lynis
      - curl
      - dnsutils
  system_init:
    Debian:
      - curl
      - wget
      - git
      - gnupg
      - lsb-release
      - software-properties-common
      - apt-transport-https
      - ca-certificates
      - cloudflared
      - docker.io
      - docker-compose
  watch:
    Debian:
      - prometheus-node-exporter
  monitor:
    Debian:
      - prometheus
      - grafana
      - node-exporter
  # Application roles
  misskey:
    Debian:
      - docker.io
      - docker-compose
      - postgresql-client
      - redis-tools
  misskey_proxy:
    Debian:
      - nginx
      - certbot
      - python3-certbot-nginx
  misskey_backup:
    Debian:
      - rclone
      - postgresql-client
      - redis-tools
  minio:
    Debian:
      - docker.io
      - docker-compose
  matrix:
    Debian:
      - docker.io
      - docker-compose
      - postgresql-client
      - redis-tools
  # AI/ML roles
  ai:
    Debian:
      - mecab
      - mecab-ipadic-utf8
      - libmecab-dev
      - python3
      - python3-pip
      - python3-dev
      - python3-venv
      - git
  # Development roles
  ghq:
    Debian:
      - git
      - curl
      - wget
  # Infrastructure roles
  cloudflared:
    Debian:
      - curl
      - wget
      - gnupg
      - ca-certificates
  cloudflare_warp:
    Debian:
      - curl
      - wget
      - gnupg
      - ca-certificates
  # Web services
  modsecurity_nginx:
    Debian:
      - nginx
      - libapache2-mod-security2
      - nginx-module-headers-more
  # Database roles (if needed)
  postgresql:
    Debian:
      - postgresql
      - postgresql-client
      - postgresql-contrib
  mysql:
    Debian:
      - mysql-server
      - mysql-client
  redis:
    Debian:
      - redis-server
      - redis-tools
  # Monitoring roles
  grafana:
    Debian:
      - grafana
  prometheus:
    Debian:
      - prometheus
      - prometheus-node-exporter
  # Backup roles
  backup:
    Debian:
      - rclone
      - rsync
      - tar
      - gzip
  # Testing roles
  integration_test:
    Debian:
      - python3-pytest
      - python3-tox
      - docker.io
  system_test:
    Debian:
      - docker.io
      - curl
      - jq
  # Utility roles
  tools:
    Debian:
      - curl
      - wget
      - git
      - htop
      - btop
      - jq
      -   # Application-specific roles
  minecraft:
    Debian:
      - docker.io
      - docker-compose
      - playit
      - curl
      - gnupg
  jitsi:
    Debian:
      - docker.io
      - docker-compose
      - nginx
  lemmy:
    Debian:
      - docker.io
      - docker-compose
      - postgresql-client
  searxng:
    Debian:
      - docker.io
      - docker-compose
  outline:
    Debian:
      - docker.io
      - docker-compose
      - postgresql-client
  vikunja:
    Debian:
      - docker.io
      - docker-compose
      - postgresql-client
  cryptpad:
    Debian:
      - docker.io
      - docker-compose
  ctfd:
    Debian:
      - docker.io
      - docker-compose
      - python3
      - python3-pip
  neo_quesdon:
    Debian:
      - docker.io
      - docker-compose
  mcaptcha:
    Debian:
      - docker.io
      - docker-compose
  deeplx:
    Debian:
      - docker.io
      - docker-compose
  impostor:
    Debian:
      - docker.io
      - docker-compose
  uptime:
    Debian:
      - docker.io
      - docker-compose
  stalwart:
    Debian:
      - docker.io
      - docker-compose
  zitadel:
    Debian:
      - docker.io
      - docker-compose
  operations:
    Debian:
      - docker.io
      - docker-compose
  migrate:
    Debian:
      - docker.io
      - docker-compose
      - rclone
  migrate_minio:
    Debian:
      - docker.io
      - docker-compose
      - rclone
      - mc
  migration_validator:
    Debian:
      - docker.io
      - docker-compose
      - curl
      - jq
  export:
    Debian:
      - docker.io
      - docker-compose
      - rclone
  import:
    Debian:
      - docker.io
      - docker-compose
      - rclone
  compat:
    Debian:
      - docker.io
      - docker-compose

# Tag-based package mapping
# Packages can be installed based on Ansible tags
packages_by_tag:
  # System tags
  always:
    Debian:
      - curl
      - wget
      - git
  packages:
    Debian:
      - apt-transport-https
      - ca-certificates
      - gnupg
      - lsb-release
  # Security tags
  security:
    Debian:
      - fail2ban
      - ufw
      - clamav
  hardening:
    Debian:
      - fail2ban
      - ufw
      - clamav
      - apparmor
      - auditd
  # Monitoring tags
  monitoring:
    Debian:
      - prometheus
      - grafana
      - prometheus-node-exporter
  prometheus:
    Debian:
      - prometheus
      - prometheus-node-exporter
  node_exporter:
    Debian:
      - prometheus-node-exporter
  cadvisor:
    Debian:
      - docker.io
  system:
    Debian:
      - htop
      - btop
      - sysstat
      - lynis
  # Infrastructure tags
  infrastructure:
    Debian:
      - docker.io
      - docker-compose
  docker:
    Debian:
      - docker.io
      - docker-compose
  # Web service tags
  proxy:
    Debian:
      - nginx
      - certbot
      - python3-certbot-nginx
  nginx:
    Debian:
      - nginx
      - nginx-module-headers-more
  reverse-proxy:
    Debian:
      - nginx
      - certbot
      - python3-certbot-nginx
  ssl:
    Debian:
      - certbot
      - python3-certbot-nginx
  # Storage tags
  storage:
    Debian:
      - rclone
      - rsync
  minio:
    Debian:
      - docker.io
      - docker-compose
  object-storage:
    Debian:
      - docker.io
      - docker-compose
  backup:
    Debian:
      - rclone
      - rsync
      - tar
      - gzip
  # Development tags
  development:
    Debian:
      - git
      - vim
      - nano
  git:
    Debian:
      - git
  repository:
    Debian:
      - git
  yamisskey:
    Debian:
      - docker.io
      - docker-compose
      - postgresql-client
      - redis-tools
  # Application tags
  misskey:
    Debian:
      - docker.io
      - docker-compose
      - postgresql-client
      - redis-tools
  minecraft:
    Debian:
      - docker.io
      - docker-compose
      - playit
  papermc:
    Debian:
      - docker.io
      - docker-compose
      - playit
  geyser:
    Debian:
      - docker.io
      - docker-compose
      - playit
  floodgate:
    Debian:
      - docker.io
      - docker-compose
      - playit
  # Testing tags
  test:
    Debian:
      - python3-pytest
      - python3-tox
      - docker.io
  connectivity:
    Debian:
      - curl
      - jq
      - nmap
  validation:
    Debian:
      - curl
      - jq
  migration:
    Debian:
      - docker.io
      - docker-compose
      - rclone
  services:
    Debian:
      - docker.io
      - docker-compose
  # Performance tags
  perf:
    Debian:
      - htop
      - btop
      - sysstat
  # Application-specific tags
  app:
    Debian:
      - docker.io
      - docker-compose
  service:
    Debian:
      - docker.io
      - docker-compose
  info:
    Debian:
      - curl
      - jq

# Base packages (always installed)
packages_base:
  Debian:
    - curl
    - wget
    - openssh-client
    - git
    - net-tools
    - nmap
    - dnsutils
    - htop
    - btop
    - sysstat
    - lynis
    - jq
    -     - unzip
    - zip
    - tar
    - gawk
    - sed
    - findutils
    - coreutils
    - rsync
    - lsof
    - tmux

# Profile-based package sets
packages_profiles:
  development:
    Debian:
      - ansible
      - ansible-lint
      - yamllint
      - gnupg
      - docker.io
      - docker-compose
      - python3-passlib
      - git
      - vim
      - nano
      - tree
      - htop
      - btop
      - jq
      -       - curl
      - wget
  server:
    Debian:
      - btop
      - net-tools
      - nmap
      - inetutils-traceroute
      - rsync
      - zip
      - tor
      - mecab
      - libmecab-dev
      - mecab-ipadic-utf8
      - prometheus
      - rclone
      - fail2ban
      - unattended-upgrades
      - debsums
      - apt-show-versions
      - clamav
      - clamav-daemon
      - lynis
      - apparmor
      - auditd
      - sysstat
      - python3-passlib
      - rsyslog
      - logrotate
      - ufw
      - curl
      - dnsutils
      - docker.io
      - docker-compose
      - nginx
      - postgresql-client
      - redis-tools
  ai-server:
    Debian:
      - mecab
      - mecab-ipadic-utf8
      - libmecab-dev
      - python3
      - python3-pip
      - python3-dev
      - python3-venv
      - git
      - docker.io
      - docker-compose
      - htop
      - btop
      - jq
      -       - curl
      - wget
  monitoring:
    Debian:
      - prometheus
      - grafana
      - prometheus-node-exporter
      - docker.io
      - docker-compose
      - htop
      - btop
      - sysstat
      - lynis
      - curl
      - wget
  storage:
    Debian:
      - rclone
      - rsync
      - tar
      - gzip
      - docker.io
      - docker-compose
      - postgresql-client
      - redis-tools
      - curl
      - wget
