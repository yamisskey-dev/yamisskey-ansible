---
dependency:
  name: galaxy
  options:
    requirements-file: ../../requirements.yml
driver:
  name: docker
platforms:
  - name: monitor-test-instance
    image: "{{ env.MOLECULE_IMAGE | default('nixos/nix:2.21.5') }}"
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
      - /var/run/docker.sock:/var/run/docker.sock
    cgroupns_mode: host
    tmpfs:
      - /run
      - /tmp
    capabilities:
      - SYS_ADMIN
    command: /lib/systemd/systemd
    networks:
      - name: molecule-test-network
provisioner:
  name: ansible
  inventory:
    host_vars:
      monitor-test-instance:
        # Test configuration for Docker-based monitoring
        domain: "test.local"
        primary_domain: "test.local"
        monitor_compose_dir: "/opt/monitor"
        grafana_admin_password: "testpassword123"
        
        # Service port configuration for testing
        monitor_services:
          prometheus: 9090
          grafana: 3000
          alertmanager: 9093
          blackbox: 9115
        
        # Test monitoring targets (simplified for testing)
        monitor_targets:
          - name: "localhost"
            host: "localhost"
            port: 9100
            role: "test-server"
            cadvisor_port: 8085
        
        # External endpoints for testing (simplified)
        monitor_external_endpoints:
          - "http://localhost:3000"
          - "http://localhost:9090"
        
        # Enable health checks
        health_check_timeout: 60
        health_check_retries: 3
        
        # Alertmanager configuration for testing
        alertmanager_group_wait: "10s"
        alertmanager_group_interval: "10s"
        alertmanager_repeat_interval: "1h"
verifier:
  name: ansible
