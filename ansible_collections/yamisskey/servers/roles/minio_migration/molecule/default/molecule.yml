---
dependency:
  name: galaxy
driver:
  name: docker
platforms:
  - name: minio-migration-test-instance
    image: geerlingguy/docker-ubuntu2204-ansible:latest
    command: ${MOLECULE_DOCKER_COMMAND:-""}
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    privileged: true
    pre_build_image: true
    networks:
      - name: minio-migration-network
provisioner:
  name: ansible
  config_options:
    defaults:
      interpreter_python: auto_silent
      callback_whitelist: profile_tasks, timer, yaml
    ssh_connection:
      pipelining: false
  inventory:
    host_vars:
      minio-migration-test-instance:
        # Role-specific test configuration
        ansible_hostname: "minio-migration-test-instance"
        ansible_default_ipv4:
          address: "127.0.0.1"

        # MinIO configuration for testing
        source_minio_host: "minio-migration-test-instance"
        target_minio_host: "minio-migration-test-instance"
        source_minio_ip: "127.0.0.1"
        source_minio_port: 9000
        target_minio_port: 9001

        # Override aliases for testing
        source_minio_alias: "test-source"
        target_minio_alias: "test-target"
        migration_temp_dir: "/tmp/test-migration"

        # Bucket configuration
        minio_bucket_name_for_misskey: "test-files"
        minio_bucket_name_for_outline: "test-assets"
        buckets_to_migrate:
          - "test-files"
          - "test-assets"

        # Test-specific overrides
        test_environment: true
        debug_mode: true
        verbose_logging: true

        # Validation settings for testing
        validate_parameters: true
        validate_connectivity: false  # Skip connectivity in container
        validate_services: false     # Skip service validation in container
        validate_capacity: false     # Skip capacity validation in container
        validate_integrity: false    # Skip integrity validation in container
        validate_readiness: false    # Skip readiness validation in container

        # Phase control for testing
        minio_migration_phases:
          setup: true
          validate: true  # Will run parameter validation only
          migrate: false  # Skip actual migration in tests
          verify: false   # Skip verification in tests
          cleanup: true

        # Mock MinIO secrets
        minio:
          root_user: "test-access-key"
          root_password: "test-secret-key"

        # Host services mock
        host_services:
          minio-migration-test-instance:
            minio_api: 9000

        # Override complex operations for testing
        ansible_date_time:
          epoch: "1234567890"
          iso8601: "2024-01-01T00:00:00Z"
verifier:
  name: ansible
