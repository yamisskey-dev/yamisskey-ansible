---
# MinIO Migration Role - Main Tasks
# Unified migration role with tag-based phase control

- name: Display migration banner
  debug:
    msg: |
      â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
      â•‘             MinIO Migration Role              â•‘
      â•‘    Unified migration with flexible control    â•‘
      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      ğŸ“‹ Migration Plan:
      â”œâ”€ Source: {{ source_minio_host }}:{{ source_minio_port }}
      â”œâ”€ Target: {{ target_minio_host }}:{{ target_minio_port }}
      â”œâ”€ Buckets: {{ buckets_to_migrate | join(', ') }}
      â””â”€ Phase Control: Tag-based execution

      ğŸ·ï¸  Available Tags:
      â”œâ”€ setup: MinIO CLI installation and configuration
      â”œâ”€ validate: Pre-migration validation
      â”œâ”€ migrate: Data migration execution
      â”œâ”€ verify: Post-migration verification
      â”œâ”€ cleanup: Temporary files cleanup
      â””â”€ all: Execute all phases
  tags: ['always']

- name: Set up MinIO CLI and configuration
  include_tasks: setup.yml
  when: minio_migration_phases.setup | default(true)
  tags: ['setup', 'all']

- name: Pre-migration validation
  include_tasks: validate.yml
  when: minio_migration_phases.validate | default(true)
  tags: ['validate', 'all']

- name: Execute data migration
  include_tasks: migrate.yml
  when: minio_migration_phases.migrate | default(true)
  tags: ['migrate', 'all']

- name: Post-migration verification
  include_tasks: verify.yml
  when: minio_migration_phases.verify | default(true)
  tags: ['verify', 'all']

- name: Clean up temporary files
  include_tasks: cleanup.yml
  when: minio_migration_phases.cleanup | default(true)
  tags: ['cleanup', 'all']

- name: Display migration completion summary
  debug:
    msg: |
      âœ… MinIO Migration Completed Successfully
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      ğŸ“Š Migration Summary:
      â”œâ”€ Source: {{ source_minio_host }}:{{ source_minio_port }}
      â”œâ”€ Target: {{ target_minio_host }}:{{ target_minio_port }}
      â”œâ”€ Buckets: {{ buckets_to_migrate | join(', ') }}
      â”œâ”€ Encryption: {{ 'Enabled' if enable_encryption else 'Disabled' }}
      â””â”€ Status: âœ… Complete

      ğŸ¯ Usage Examples:
      â”œâ”€ ansible-playbook playbook.yml --tags setup
      â”œâ”€ ansible-playbook playbook.yml --tags validate
      â”œâ”€ ansible-playbook playbook.yml --tags migrate
      â”œâ”€ ansible-playbook playbook.yml --tags verify
      â””â”€ ansible-playbook playbook.yml --tags all
  tags: ['always']
