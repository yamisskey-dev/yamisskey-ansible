---
- name: Add Playit GPG key
  get_url:
    url: https://playit-cloud.github.io/ppa/key.gpg
    dest: /tmp/playit.gpg
    mode: '0644'

- name: Install Playit GPG key
  shell: gpg --dearmor < /tmp/playit.gpg > /etc/apt/trusted.gpg.d/playit.gpg
  args:
    creates: /etc/apt/trusted.gpg.d/playit.gpg

- name: Set Playit GPG key permissions
  file:
    path: /etc/apt/trusted.gpg.d/playit.gpg
    mode: '0644'

- name: Add Playit repository
  apt_repository:
    repo: "deb [signed-by=/etc/apt/trusted.gpg.d/playit.gpg] https://playit-cloud.github.io/ppa/data ./"
    filename: playit-cloud
    state: present

- name: Clean up temporary GPG file
  file:
    path: /tmp/playit.gpg
    state: absent

- name: Update apt cache
  apt:
    update_cache: true

- name: Install Playit
  apt:
    name: playit
    state: present

- name: Verify Playit installation
  command: playit --version
  register: playit_version
  failed_when: false
  changed_when: false

- name: Display Playit installation result
  debug:
    msg: |-
      Playit: {{ '✅ Installed' if playit_version.rc == 0 else '⚠️ Installation may have failed' }}