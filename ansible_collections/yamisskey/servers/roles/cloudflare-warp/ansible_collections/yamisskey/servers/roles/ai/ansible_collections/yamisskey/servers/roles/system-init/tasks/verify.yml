---
- name: Check Ansible version
  ansible.builtin.command: ansible --version
  register: ansible_ver
  failed_when: false
  changed_when: false

- name: Check Docker version
  ansible.builtin.command: docker --version
  register: docker_ver
  failed_when: false
  changed_when: false

- name: Check Tailscale version
  ansible.builtin.command: tailscale version
  register: tailscale_ver
  failed_when: false
  changed_when: false

- name: Check Cloudflared version
  ansible.builtin.command: cloudflared version
  register: cloudflared_ver
  failed_when: false
  changed_when: false

- name: Check WARP version
  ansible.builtin.command: warp-cli --version
  register: warp_ver
  failed_when: false
  changed_when: false

- name: Check Playit version
  ansible.builtin.command: playit --version
  register: playit_ver
  failed_when: false
  changed_when: false

- name: Build verification summary
  ansible.builtin.set_fact:
    verification_summary: |
      ğŸ“¦ Installation Verification:
      âœ… Ansible: {{ (ansible_ver.stdout_lines | first) | default('not found') }}
      âœ… Docker: {{ docker_ver.stdout | default('not found') }}
      âœ… Tailscale: {{ tailscale_ver.stdout | default('not found') }}
      âœ… Cloudflared: {{ cloudflared_ver.stdout | default('not found') }}
      {{ 'âœ… Cloudflare WARP: ' + warp_ver.stdout if (warp_ver.rc | default(1)) == 0 else 'âš ï¸ Cloudflare WARP: not found' }}
      {{ 'âœ… Playit: ' + playit_ver.stdout if (playit_ver.rc | default(1)) == 0 else 'âš ï¸ Playit: not found' }}

- name: Display verification results
  ansible.builtin.debug:
    msg: "{{ verification_summary.split('\n') }}"
