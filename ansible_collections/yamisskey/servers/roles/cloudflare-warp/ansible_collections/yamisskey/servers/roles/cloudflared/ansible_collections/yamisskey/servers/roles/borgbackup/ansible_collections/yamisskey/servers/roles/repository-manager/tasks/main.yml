---
# Repository Manager Role - Main Tasks
# Handles git repository cloning, updating, backup, and restoration

- name: Display repository management plan
  debug:
    msg: |
      ðŸ”„ Repository Management Plan:
      Operation: {{ repo_operation | default('clone') }}
      Target: {{ repo_target | default('all') }}
      {% if repositories is defined %}
      Repositories:
      {% for repo in repositories %}
      - {{ repo.name }}: {{ repo.dest }}
      {% endfor %}
      {% endif %}
  tags: ['info', 'plan']

- name: Repository directory preparation
  include_tasks: directory_setup.yml
  when: repo_operation in ['clone', 'update', 'restore']
  tags: ['setup', 'directories']

- name: Repository existence check
  include_tasks: repository_check.yml
  when: repo_operation in ['clone', 'update', 'backup', 'status']
  tags: ['check', 'validation']

- name: Clone repositories
  include_tasks: clone_repositories.yml
  when: repo_operation in ['clone', 'update']
  tags: ['clone', 'git']

- name: Update repositories
  include_tasks: update_repositories.yml
  when: repo_operation == 'update'
  tags: ['update', 'git']

- name: Backup repositories
  include_tasks: backup_repositories.yml
  when: repo_operation == 'backup'
  tags: ['backup', 'archive']

- name: Restore repositories
  include_tasks: restore_repositories.yml
  when: repo_operation == 'restore'
  tags: ['restore', 'recovery']

- name: Repository status check
  include_tasks: status_check.yml
  when: repo_operation == 'status'
  tags: ['status', 'info']

- name: Final verification
  include_tasks: verification.yml
  when: repo_operation in ['clone', 'update', 'restore']
  tags: ['verify', 'validation']