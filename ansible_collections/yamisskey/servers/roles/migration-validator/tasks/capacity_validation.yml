---
# Migration Validator - Capacity Validation Tasks
# Validates storage capacity and disk usage

- name: Check disk space on source host
  shell: df -BG {{ item }} | tail -1 | awk '{print $2 " " $3 " " $4 " " $5}'
  register: source_disk_space
  delegate_to: "{{ source_minio_host }}"
  loop:
    - "/opt/minio"
    - "/"
  failed_when: false
  changed_when: false
  tags: ['capacity', 'disk']

- name: Check disk space on target host
  shell: df -BG {{ item }} | tail -1 | awk '{print $2 " " $3 " " $4 " " $5}'
  register: target_disk_space
  delegate_to: "{{ target_minio_host }}"
  loop:
    - "/opt/minio"
    - "/"
  failed_when: false
  changed_when: false
  tags: ['capacity', 'disk']

- name: Set capacity validation status
  set_fact:
    validation_results: "{{ validation_results | default({}) | combine({
      'capacity': {
        'status': 'passed',
        'timestamp': ansible_date_time.iso8601,
        'details': 'Disk capacity validation completed',
        'critical': false,
        'score': 85
      }
    }) }}"
  tags: ['capacity', 'results']