---
- name: Verify
  hosts: all
  become: true
  tasks:
    - name: Verify ghq is installed
      command: ghq --version
      register: ghq_version
      changed_when: false
      failed_when: false

    - name: Assert ghq is installed
      assert:
        that:
          - ghq_version.rc == 0
        fail_msg: "ghq is not installed"
        success_msg: "ghq is installed successfully"

    - name: Verify ghq configuration
      stat:
        path: "{{ ansible_env.HOME }}/.config/ghq/config"
      register: ghq_config

    - name: Assert ghq configuration exists
      assert:
        that:
          - ghq_config.stat.exists
        fail_msg: "ghq configuration file does not exist"
        success_msg: "ghq configuration file exists"

    - name: Verify ghq root directory
      stat:
        path: "{{ ghq_root | expanduser }}"
      register: ghq_root_dir

    - name: Assert ghq root directory exists
      assert:
        that:
          - ghq_root_dir.stat.exists
        fail_msg: "ghq root directory does not exist"
        success_msg: "ghq root directory exists"
