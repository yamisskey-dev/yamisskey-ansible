---
- name: Clone yamisskey-dev repositories
  command: ghq get {{ item }}
  loop: "{{ yamisskey_repositories }}"
  register: ghq_clone_results
  failed_when: false
  changed_when: ghq_clone_results.rc == 0
  when: ansible_env.MOLECULE_SCENARIO_NAME is not defined

- name: Skip clone in test environment
  debug:
    msg: "Skipping repository clone in test environment"
  when: ansible_env.MOLECULE_SCENARIO_NAME is defined

- name: Display clone results
  debug:
    msg: |
      üîÑ Repository Clone Results:
      {% for result in ghq_clone_results.results %}
      - {{ result.item }}: {{ '‚úÖ Cloned successfully' if result.rc == 0 else '‚ùå Clone failed' }}
      {% if result.rc != 0 and result.stderr is defined %}
        Error: {{ result.stderr }}
      {% endif %}
      {% endfor %}
  when: ansible_env.MOLECULE_SCENARIO_NAME is not defined

- name: List cloned repositories
  command: ghq list
  register: ghq_list_result
  changed_when: false
  failed_when: false
  when: ansible_env.MOLECULE_SCENARIO_NAME is not defined

- name: Display cloned repositories
  debug:
    msg: |
      üìÅ Cloned repositories in {{ ghq_root }}:
      {{ ghq_list_result.stdout_lines | join('\n') }}
  when: 
    - ansible_env.MOLECULE_SCENARIO_NAME is not defined
    - ghq_list_result.rc == 0
