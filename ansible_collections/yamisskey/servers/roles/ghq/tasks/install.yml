---
- name: Check if running in Nix environment
  shell: command -v nix >/dev/null 2>&1
  register: nix_available
  failed_when: false
  changed_when: false

- name: Ensure Nix environment
  fail:
    msg: |
      âŒ GHQ role requires Nix environment!
      
      ğŸ“‹ GHQ and Go are now managed via Nix Flake:
      - ghq: Available via Home Manager
      - go: Available via Home Manager
      
      Please run in nix develop environment.
  when: nix_available.rc != 0

- name: Display GHQ package status
  debug:
    msg: |
      âœ… GHQ packages managed via Nix Flake
      ğŸ“¦ Available tools: ghq, go
      ğŸš€ Ready for repository management!

- name: Check if ghq is available
  command: ghq --version
  register: ghq_version_check
  failed_when: false
  changed_when: false

- name: Display ghq version
  debug:
    msg: "ghq version: {{ ghq_version_check.stdout }}"
  when: ghq_version_check.rc == 0
